"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.fetchMetals = void 0;
const promisify_child_process_1 = require("promisify-child-process");
function fetchMetals({ serverVersion, serverProperties, javaConfig: { javaPath, javaOptions, extraEnv, coursierPath }, }) {
    const fetchProperties = serverProperties.filter((p) => !p.startsWith("-agentlib"));
    const serverDependency = serverVersion.includes(":")
        ? serverVersion
        : `org.scalameta:metals_2.12:${serverVersion}`;
    return promisify_child_process_1.spawn(javaPath, [
        ...javaOptions,
        ...fetchProperties,
        "-Dfile.encoding=UTF-8",
        "-jar",
        coursierPath,
        "fetch",
        "-p",
        "--ttl",
        // Use infinite ttl to avoid redunant "Checking..." logs when using SNAPSHOT
        // versions. Metals SNAPSHOT releases are effectively immutable since we
        // never publish the same version twice.
        "Inf",
        serverDependency,
        "-r",
        "bintray:scalacenter/releases",
        "-r",
        "sonatype:public",
        "-r",
        "sonatype:snapshots",
        "-p",
    ], {
        env: Object.assign(Object.assign({ COURSIER_NO_TERM: "true" }, extraEnv), process.env),
        stdio: ["ignore"],
    });
}
exports.fetchMetals = fetchMetals;
